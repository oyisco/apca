<html class="loading" lang="en" data-textdirection="ltr" xmlns:th="https://www.thymeleaf.org/">
<head th:replace="includes/user/header :: header"  />
<link th:href="@{../public/app-assets/vendors/css/ui/jquery-ui.min.css}" rel="stylesheet" type="text/css" />
<link th:href="@{../public/assets/css/MonthPicker.min.css}" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" th:href="@{../public/app-assets/css/plugins/loaders/loaders.min.css}">
<link rel="stylesheet" type="text/css" th:href="@{../public/app-assets/css/core/colors/palette-loader.css}">
<link rel="stylesheet" type="text/css" th:href="@{../public/app-assets/vendors/css/extensions/toastr.css}">
<link rel="stylesheet" type="text/css" th:href="@{../public/app-assets/css/plugins/extensions/toastr.css}">
<body class="vertical-layout vertical-menu 2-columns   menu-expanded fixed-navbar" data-open="click" data-menu="vertical-menu" data-col="2-columns">

<!-- fixed-top-->
<div th:replace="includes/user/topbar :: topbar"  />

<!-- query String -->
<!-- ////////////////////////////////////////////////////////////////////////////-->



<div th:replace="includes/user/navbar :: navbar"  />

</div>
<div class="app-content content">
    <div class="content-wrapper">
        <div class="content-header row">
        </div>

        <div class="content-body"><!-- Analytics charts -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-content">
                            <div class="card-body">

                                <div class="card-header">

                                    <!--<div class="loader-container">
                                        <div class="ball-pulse loader-primary">
                                            <div></div>
                                            <div></div>
                                            <div></div>
                                        </div>
                                    </div>-->
                                    <h4 class="form-section"><i class="fa fa-users"></i> View Users</h4>
                                    <div class="heading-elements">
                                        <ul class="list-inline mb-0">
                                            <!--<li><a data-action="collapse"><i class="ft-minus"></i></a></li>
                                            <li><a data-action="reload"><i class="ft-rotate-cw"></i></a></li>-->
                                            <li><a data-action="expand"><i class="ft-maximize"></i></a></li>
                                            <!--<li><a data-action="close"><i class="ft-x"></i></a></li>-->
                                        </ul>
                                    </div>
                                </div>

                                <div class="card-content collpase show">
                                    <div class="card-body">

                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead class="bg-info white">
                                                <tr>
                                                    <th>S/N</th>
                                                    <th>Username</th>
                                                    <!--<th>User Role</th>
                                                    <th>Modules</th>
                                                    <th>Countries</th>-->
                                                    <th>Action</th>
                                                </tr>
                                                </thead>
                                                <tbody th:with="counter=0">


                                                <tr th:each="user, iterator: ${users}"   >
                                                    <!--                                    -->
                                                    <!--                                           <div class="btn-group mr-1 mb-1" th:if="${role == 'user'}">-->
                                                    <!--		                                        <button type="button" class="btn btn-success btn-min-width dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Action</button>-->
                                                    <!--		                                        <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 40px, 0px); top: 0px; left: 0px; will-change: transform;">-->
                                                    <!--		                                            <a class="dropdown-item"  th:href="'edit-user?id=' + ${user.get('id')}">Edit User</a>-->
                                                    <!--		                                             <a class="dropdown-item resetPassword" th:data-username="${user.get('username')}"  th:data-userId="${user.get('id')}" href="javascript:void(0);">Reset Password</a>-->
                                                    <!--		                                        </div>-->
                                                    <!--		                                    </div>-->

                                                    <div class="btn-group mr-1 mb-1" th:if="${role == 'admin'}">
                                                        <td th:text="${iterator.count}"></td >
                                                        <td th:text="${user.get('username')}"></td>
                                                        <td>
                                                            <button type="button" class="btn btn-success btn-min-width dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Action</button>
                                                            <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 40px, 0px); top: 0px; left: 0px; will-change: transform;">
                                                                <a class="dropdown-item"  th:href="'edit-user1?id=' + ${user.get('id')}">Edit User</a>
                                                                <a class="dropdown-item resetPassword" th:data-username="${user.get('username')}"  th:data-userId="${user.get('id')}" href="javascript:void(0);">Reset Password</a>
                                                            </div>

                                                        </td>
                                                    </div>

                                                </tr >


                                                </tbody >
                                            </table>
                                        </div>

                                    </div>
                                    <div class='box-content'>
                                        <div class="row">
                                            <div class="col-sm-12 col-md-5">
                                                <div class="dataTables_info" id="DataTables_Table_0_info" role="status" aria-live="polite">Showing <span th:text="${pagination.lowerBound()}"></span> - <span th:text="${pagination.upperBound()}"> out of <span th:text="${pagination.total_count}"></span></div>
                                            </div>

                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--/ Analytics charts -->


                <!-- Analytics map based session -->

                <!-- Bounce Rate & Mobile Device View -->

                <!-- Audience by country -->
                <!--  -->

            </div>
        </div>
        <div th:replace="includes/user/footer :: footer"  />
    </div>
    <!-- ////////////////////////////////////////////////////////////////////////////-->


    <div class="modal fade" id="resetPasswordModal" aria-labelledby="modalLabel" role="dialog" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel" style="color:#444">Reset Password for <span id="usernameToReset"></span ></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body " style="text-align:center">
                    <div class="row">
                        <label class="col-md-3 col-sm-6">New Password</label >
                        <div class="col-sm-6 col-md-9">
                            <input type="text" name="newPassword" id="newPassword" class="form-control" />
                            <input type="hidden" name="userId" id="userId" />
                        </div >
                    </div >

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" id="resetPassword">Reset Password <i class="fa fa-spinner fa-spin hidden" id="switchSpoke"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{../public/app-assets/js/scripts/extensions/toastr.js}" type="text/javascript"></script>
    <script th:src="@{../public/app-assets/vendors/js/extensions/toastr.min.js}"></script>
    <script th:src="@{../public/assets/js/saveScript.js}" type="text/javascript"></script>
    <script type="text/javascript" th:src="@{../public/assets/js/jquery.validate.min.js}"></script>
    <script type="text/javascript" th:src="@{../public/app-assets/vendors/js/ui/jquery-ui.min.js}"></script>
    <script type="text/javascript" th:src="@{../public/assets/js/validationScript.js}"></script>
    <script type="text/javascript" th:src="@{../public/assets/js/MonthPicker.js}"></script>
    <script type="text/javascript" th:src="@{../public/assets/js/miscScript.js}"></script>
    <script type="text/javascript">
        var periodType = "monthly";
        $(document).ready(function(e){
            $(".resetPassword").click(function(){
                var username = $(this).attr("data-username");
                var userId = $(this).attr("data-userid");
                $("#userId").val(userId);
                $("#resetPasswordModal").modal("show");
                $("#usernameToReset").html(username);
            })

            $("#resetPassword").click(function(){
                var userId = $("#userId").val();
                var newPassword = $("#newPassword").val();

                $("#resetPassword").attr("disabled", "disabled");
                $("#resetPassword").html("Resetting...");
                if(newPassword.trim() == "")
                {
                    alert("Please fill out new password");
                }else{
                    //go ahead to change the password
                    $.ajax({
                        url:"../reset-password",
                        type:"POST",
                        data:{userId:userId, password:newPassword},
                        success:function(response){
                            if(response == "ok")
                            {
                                toastr.success('Success!!', 'Password has been reset', {positionClass: 'toast-top-right', containerId: 'toast-top-right' });
                                $("#resetPasswordModal").modal("hide");

                            }
                            else{
                                toastr.success('Error!!', 'An error occured. please try again', {positionClass: 'toast-top-right', containerId: 'toast-top-right' });
                            }
                        },
                        error:function(xhr, status){
                            console.log(xhr, status)
                        },
                        complete:function()
                        {
                            $("#resetPassword").removeAttr("disabled");
                            $("#resetPassword").html("Reset Password");
                        }
                    })
                }
            });
        })


    </script>
</body>
</html>